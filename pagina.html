<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<title>Reporte de Mantenimiento Realizado</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<style>
    body {
        font-family: Arial, sans-serif;
        padding: 10px;
        background: #f0f0f0;
        margin: 0;
    }
    .container {
        max-width: 100%;
        background: #fff;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0px 0px 10px #ccc;
    }
    h2 { text-align: center; color: #2c3e50; margin-bottom: 20px; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input[type="text"], input[type="date"] {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }
    table { width: 100%; margin-top: 20px; border-collapse: collapse; }
    th, td { padding: 8px; border-bottom: 1px solid #ccc; }
    th { background-color: #e8e8e8; }
    button, a.whatsapp-btn {
        margin-top: 20px; width: 100%; padding: 12px;
        font-size: 16px; border: none; border-radius: 8px;
        cursor: pointer; display: inline-block; text-align: center;
        text-decoration: none;
    }
    button { background-color: #27ae60; color: white; }
    button:hover { background-color: #219150; }
    a.whatsapp-btn { background-color: #25D366; color: white; display: none; }
    a.whatsapp-btn:hover { background-color: #1ebe5d; }
</style>
</head>
<body>
<div class="container">
<h2>ğŸ”§ Reporte de Mantenimiento</h2>
<label>ğŸ‘¤ Nombre:</label><input id="nombre" type="text"/>
<label>ğŸš— Marca:</label><input id="marca" type="text"/>
<label>ğŸ“˜ Modelo:</label><input id="modelo" type="text"/>
<label>ğŸ“† AÃ±o:</label><input id="anio" type="text"/>
<label>ğŸ”¢ Chapa:</label><input id="chapa" type="text"/>
<label>ğŸ“ Kilometraje:</label><input id="km" type="text"/>
<label>ğŸ“… Fecha:</label><input id="fecha" type="date"/>
<label>ğŸ§‘â€ğŸ”§ TÃ©cnico:</label><input id="tecnico" type="text"/>
<form id="mantenimientoForm">
<table>
<tr><th>ğŸ›  Ãtem</th><th>âœ… Â¿Realizado?</th></tr>
<tr><td>aceite de motor</td><td><input checked name="aceite_de_motor" type="radio" value="no"/> No <input name="aceite_de_motor" type="radio" value="si"/> SÃ­</td></tr>
<tr><td>filtro de aceite</td><td><input checked name="filtro_de_aceite" type="radio" value="no"/> No <input name="filtro_de_aceite" type="radio" value="si"/> SÃ­</td></tr>
<tr><td>filtro de aire</td><td><input checked name="filtro_de_aire" type="radio" value="no"/> No <input name="filtro_de_aire" type="radio" value="si"/> SÃ­</td></tr>
<tr><td>filtro de combustible</td><td><input checked name="filtro_de_combustible" type="radio" value="no"/> No <input name="filtro_de_combustible" type="radio" value="si"/> SÃ­</td></tr>
<tr><td>filtro de habitÃ¡culo</td><td><input checked name="filtro_de_habitÃ¡culo" type="radio" value="no"/> No <input name="filtro_de_habitÃ¡culo" type="radio" value="si"/> SÃ­</td></tr>
<tr><td>aceite de caja</td><td><input checked name="aceite_de_caja" type="radio" value="no"/> No <input name="aceite_de_caja" type="radio" value="si"/> SÃ­</td></tr>
<tr><td>aceite de diferencial trasero</td><td><input checked name="aceite_de_diferencial_trasero" type="radio" value="no"/> No <input name="aceite_de_diferencial_trasero" type="radio" value="si"/> SÃ­</td></tr>
<tr><td>aceite de diferencial delantero</td><td><input checked name="aceite_de_diferencial_delantero" type="radio" value="no"/> No <input name="aceite_de_diferencial_delantero" type="radio" value="si"/> SÃ­</td></tr>
<tr><td>caja reductora</td><td><input checked name="caja_reductora" type="radio" value="no"/> No <input name="caja_reductora" type="radio" value="si"/> SÃ­</td></tr>
</table>

<h4>AÃ±adir servicios extra</h4>
<input type="text" id="inputTareaExtra" placeholder="Escribe un servicio extra y presiona Enter"/>
<ul id="listaTareasExtras"></ul>

<h3>ğŸ” InspecciÃ³n de Accesorios</h3>
<table>
<tr><th>Accesorio</th><th>Â¿EstÃ¡ en condiciones?</th></tr>
<tr><td>Luces</td><td><input checked name="luces" type="radio" value="no"/> âŒ No <input name="luces" type="radio" value="si"/> âœ… SÃ­</td></tr>
<tr><td>Extintor</td><td><input checked name="extintor" type="radio" value="no"/> âŒ No <input name="extintor" type="radio" value="si"/> âœ… SÃ­</td></tr>
<tr><td>Llave de ruedas</td><td><input checked name="llave_de_ruedas" type="radio" value="no"/> âŒ No <input name="llave_de_ruedas" type="radio" value="si"/> âœ… SÃ­</td></tr>
<tr><td>Refrigerante</td><td><input checked name="refrigerante" type="radio" value="no"/> âŒ No <input name="refrigerante" type="radio" value="si"/> âœ… SÃ­</td></tr>
<tr><td>Fluido de freno</td><td><input checked name="fluido_de_freno" type="radio" value="no"/> âŒ No <input name="fluido_de_freno" type="radio" value="si"/> âœ… SÃ­</td></tr>
<tr><td>Fluido de direcciÃ³n</td><td><input checked name="fluido_de_direccion" type="radio" value="no"/> âŒ No <input name="fluido_de_direccion" type="radio" value="si"/> âœ… SÃ­</td></tr>
<tr><td>LÃ­quido de frenos</td><td><input checked name="liquido_de_frenos" type="radio" value="no"/> âŒ No <input name="liquido_de_frenos" type="radio" value="si"/> âœ… SÃ­</td></tr>
</table>

<h4>AÃ±adir condiciones extra</h4>
<input type="text" id="inputCondicionExtra" placeholder="Escribe una condiciÃ³n extra y presiona Enter"/>
<ul id="listaCondicionesExtras"></ul>

<button type="button" onclick="enviarReporte()">ğŸ“¤ Guardar Reporte en Excel</button>
<a id="whatsappBtn" class="whatsapp-btn" target="_blank">ğŸ“² Enviar por WhatsApp</a>
</form>
</div>

<script>
let tareasExtras = [];
let condicionesExtras = [];

// Enter para agregar extras dinÃ¡micamente
document.getElementById("inputTareaExtra").addEventListener("keypress", function(e) {
  if (e.key === "Enter") {
    e.preventDefault();
    agregarTareaExtra();
  }
});
document.getElementById("inputCondicionExtra").addEventListener("keypress", function(e) {
  if (e.key === "Enter") {
    e.preventDefault();
    agregarCondicionExtra();
  }
});

function agregarTareaExtra() {
  const input = document.getElementById("inputTareaExtra");
  const valor = input.value.trim();
  if (valor !== "") {
    tareasExtras.push(valor);
    const li = document.createElement("li");
    li.textContent = valor;
    document.getElementById("listaTareasExtras").appendChild(li);
    input.value = "";
  }
}

function agregarCondicionExtra() {
  const input = document.getElementById("inputCondicionExtra");
  const valor = input.value.trim();
  if (valor !== "") {
    condicionesExtras.push(valor);
    const li = document.createElement("li");
    li.textContent = valor;
    document.getElementById("listaCondicionesExtras").appendChild(li);
    input.value = "";
  }
}

async function enviarReporte() {
    const data = {
        nombre: document.getElementById('nombre').value,
        marca: document.getElementById('marca').value,
        modelo: document.getElementById('modelo').value,
        anio: document.getElementById('anio').value,
        chapa: document.getElementById('chapa').value,
        km: document.getElementById('km').value,
        fecha: document.getElementById('fecha').value,
        tecnico: document.getElementById('tecnico').value,
        tareas: {},
        accesorios: {}
    };

    // Recorrer radios
    document.querySelectorAll('input[type=radio]').forEach(radio => {
        if (['luces','extintor','llave_de_ruedas','refrigerante','fluido_de_freno','fluido_de_direccion','liquido_de_frenos'].includes(radio.name)) {
            if (radio.checked) data.accesorios[radio.name] = radio.value;
        } else {
            if (radio.checked) data.tareas[radio.name] = radio.value;
        }
    });

    // âš¡ Agregar los extras de tareas y condiciones al objeto antes de enviar
    tareasExtras.forEach(t => data.tareas[t] = 'si');
    condicionesExtras.forEach(c => data.accesorios[c] = 'si');

    console.log("Enviando data:", data); // ğŸ” Verificar en consola que los extras estÃ¡n incluidos

    const url = 'https://web-production-3fcc.up.railway.app/guardar_reporte';

    try {
        const response = await fetch(url, {
            method: 'POST',
            body: JSON.stringify(data),
            headers: { 'Content-Type': 'application/json' }
        });

        const resJson = await response.json();
        if (resJson.result === 'success') { alert('Reporte guardado en Excel ğŸ‘'); }
        else { alert('Error: ' + resJson.message); }
    } catch (error) { alert('Error al enviar datos: ' + error.message); }

    // WhatsApp
    let tareasRealizadas = Object.entries(data.tareas)
        .filter(([key, value]) => value === 'si')
        .map(([key]) => `\u2705 ${key.replace(/_/g," ").replace(/\b\w/g, l => l.toUpperCase())}`)
        .join('\n');

    let accesoriosTexto = Object.entries(data.accesorios)
        .map(([key, value]) => { let simbolo = value === 'si' ? '\u2705' : '\u274C'; return `${simbolo} ${key.replace(/_/g," ").replace(/\b\w/g, l => l.toUpperCase())}`; })
        .join('\n');

    let mensaje = `ğŸ”§ REPORTE DE MANTENIMIENTO REALIZADO ğŸ”§
ğŸ‘¤ Cliente: ${data.nombre}
ğŸš— Marca: ${data.marca}
ğŸ“˜ Modelo: ${data.modelo}
ğŸ“ Kilometraje: ${data.km}
ğŸ“… Fecha: ${data.fecha}
ğŸ§‘â€ğŸ”§ TÃ©cnico: ${data.tecnico}

ğŸ›  Tareas realizadas:
${tareasRealizadas}

ğŸ” Accesorios:
${accesoriosTexto}`;

    const numero = "598981919031";
    const link = `https://wa.me/${numero}?text=${encodeURIComponent(mensaje)}`;
    const btn = document.getElementById("whatsappBtn");
    btn.href = link;
    btn.style.display = "block";
}
</script>
</body>
</html>
